{% extends "website/layout.html" %} {% block title %}–£—Å—Ç–Ω–∞—è —á–∞—Å—Ç—å –ï–ì–≠{% endblock %} {% load static %} {% block body %} {% comment %} Ege Success Message {% endcomment %}
<div id="successDiv" class="hidden">
  <div class="good_grade info margin-top margin-bottom fancy-shadow">–ó–∞–ø–∏—Å—å –æ—Ç–≤–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞! ‚úÖ</div>
  <div class="date_time_flex center-basic margin-bottom underline">–í–∫–ª–∞–¥–∫—É –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å</div>
</div>

<div id="tester" class="info">
  <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–≤—É–∫–∞<span class="emoji-margin">üîâ</span></h3>
  <div style="text-align: left; font-size: 17px">
    <ol>
      <li>–î–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–≤—É–∫–∞ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"</li>
      <li>–ù—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É <span class="date_time_flex">(–∏–Ω–∞—á–µ –≤–∞—Å –Ω–µ –±—É–¥–µ—Ç —Å–ª—ã—à–Ω–æ)</span></li>
      <div class="flex-center">
        <img style="width: 60%; height: 300px" class="image-example pc_example" src="{% static 'website/images/ege/help/allow_pc.png' %}" />
        <img class="image-example mobile_example" src="{% static 'website/images/ege/help/allow_mobile.jpg' %}" />
      </div>
      <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–∞—á–∞—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å</li>
      <li>–ù–∞–∂–º–∏—Ç–µ "–°—Ç–æ–ø"</li>
      <li>–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–∏—Ç–µ –ø–æ—è–≤–∏–≤—à–µ–µ—Å—è –∞—É–¥–∏–æ –≤ –ø–ª–µ–µ—Ä–µ</li>
      <li>–ï—Å–ª–∏ –≤—ã —Å–µ–±—è —Å–ª—ã—à–∏—Ç–µ, —Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äì –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —É—Å—Ç–Ω—É—é —á–∞—Å—Ç—å</li>
    </ol>

    <div class="center-basic">
      <button class="button" id="recordButton">–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
      <button class="button" id="stopButton" disabled>–°—Ç–æ–ø</button>
      <button id="saveButton" style="display: none" data-testname="{{ variant.ege_testname }}">Save</button>
    </div>
    <div class="center-basic margin-top">
      <audio controls id="recordedAudio">
        <source id="recordedAudioSource" type="audio/ogg" />
        Your browser does not support the audio element.
      </audio>
    </div>

    <hr />
    üëâ –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –Ω–∞–∂–º–µ—Ç–µ "–Ω–∞—á–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω" –∑–∞–ø–∏—Å—å –≤–∞—à–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞—á–Ω–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. <br />üëâ –£ –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –±—É–¥–µ—Ç —Ç–∞–π–º–µ—Ä –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∏ –Ω–∞ –æ—Ç–≤–µ—Ç üïê <br />üëâ –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
    –ø–æ—è–≤–∏—Ç—Å—è —Ç–∞–π–º–µ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –∫–æ–Ω—Ü–∞ —É—Å—Ç–Ω–æ–π —á–∞—Å—Ç–∏. <br />
    ‚úÖ –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ –∑–∞–ø–∏—Å—å –≤–∞—à–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. <span class="date_time_flex">(–∫–∞–∫ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–∏–∂–µ)</span>
    <div class="flex-center"><img class="ege-success default-shadow margin-top" src="{% static 'website/images/ege/help/success.png' %}" /></div>
  </div>
</div>

<div style="font-size: smaller" id="timer"></div>

<div class="center"><button class="button" id="start" onclick="hideButton()">–ù–∞—á–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω</button></div>

<div id="container">
  {% comment %} Text {% endcomment %}
  <div class="box-speaking" id="text">
    <div class="info fancy-shadow margin-bottom" id="timerText"></div>
    <span class="lvlC1">‚Ññ1</span> <b>Task 1.</b> Imagine that you are preparing a project with your friend. You have found some interesting material for the presentation and you want to read this text
    to your friend. You have 1.5 minutes to read the text silently, then be ready to read it out aloud. You will not have more than 1.5 minutes to read it.<br /><br />
    <div class="info text-left">{{variant.speaking_text|safe}}</div>
  </div>

  {% comment %} Ad {% endcomment %}
  <div class="box-speaking" id="ad">
    <div class="info fancy-shadow margin-bottom" id="timerAd"></div>
    <span class="lvlC1">‚Ññ2</span> <b>Task 2.</b> Study the advertisement.
    <h3 class="center-basic">{{variant.ad_header}}</h3>
    <img style="border: 2px solid white" id="speaking-image" src="{% static 'website/images/ege/' %}{{variant.ad_img}}" />
    <div>{{variant.ad_task|safe}}</div>
    <div class="info-left">
      <ol>
        {% for item in variant.ad_questions %}
        <li>{{item}}</li>
        {% endfor %}
      </ol>
    </div>
    <div>You have 20 seconds to ask each question.</div>
  </div>

  {% comment %} Interview {% endcomment %}
  <div class="box-speaking" id="interview">
    <span class="lvlC1">‚Ññ3</span> <b>Task 3.</b> You are going to give an interview. You have to answer five questions. Give full answers to the questions (2‚Äì3 sentences). Remember that you have 40
    seconds to answer each question.

    <div class="center">
      <audio id="speaking-interview" src="{% static 'website/audio/ege/' %}{{variant.interview_path}}" controls onplay="this.controls=false" preload="auto" volume="1.0"></audio>
    </div>
  </div>

  {% comment %} Monologue {% endcomment %}
  <div class="box-speaking" id="monologue">
    <div style="border-color: #555" class="center letter-border" id="timerMonologue"></div>
    <span class="lvlC1">‚Ññ4</span> <b>Task 4.</b> Imagine that you and your friend are doing a school project <b>"{{variant.monologue_topic}}"</b>. You have found some illustrations and want to share
    the news. Leave a voice message to your friend. In 2.5 minutes be ready to:
    <ul>
      {% for point in variant.monologue_points %}
      <li>{{point}}</li>
      {% endfor %}
    </ul>
    <div>You will speak for not more than 3 minutes (12‚Äì15 sentences).</div>
    <div>You have to talk continuously.</div>
    <div class="image-container">
      <div class="image-wrapper">
        <div class="image-label">Photo ‚Ññ1</div>
        <img style="border: 2px solid white" src="{% static 'website/images/ege/' %}{{variant.monologue_imgs.0}}" />
      </div>
      <div class="image-wrapper">
        <div class="image-label">Photo ‚Ññ2</div>
        <img style="border: 2px solid white" src="{% static 'website/images/ege/' %}{{variant.monologue_imgs.1}}" />
      </div>
    </div>
  </div>
</div>
<script>
  {% comment %} Hide {% endcomment %}
    function hideButton() {
      document.getElementById("start").style.display = "none";
      document.getElementById("tester").style.display = "none";
      document.getElementById("recordButton").disabled = false;
      document.getElementById("recordButton").click();
    }

  {% comment %} Toggle {% endcomment %}
    const textDiv = document.getElementById("text");
    const adDiv = document.getElementById("ad");
    const interviewDiv = document.getElementById("interview");
    const monologueDiv = document.getElementById("monologue");
    const timerDiv = document.getElementById("timer");
    const startButton = document.getElementById("start");
    const pauseButton = document.getElementById("pause");
    const resumeButton = document.getElementById("resume");
    const successDiv = document.getElementById("successDiv");

    let milli = 30;
    let timeLeft = 961;
    let timerId;
    let currentDiv = textDiv;

    function startTimer() {
      timerId = setInterval(() => {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;

        timerDiv.innerHTML = `–î–æ –∫–æ–Ω—Ü–∞ —É—Å—Ç–Ω–æ–π —á–∞—Å—Ç–∏: ${minutes}–º ${seconds}—Å`;
        timeLeft--;
        if (timeLeft === 0) {
          clearInterval(timerId);
          document.getElementById("stopButton").click();
          document.getElementById("saveButton").disabled = false;
          setTimeout(() => document.getElementById("saveButton").click(), 500);
          successDiv.classList.toggle('hidden');

        } else if (timeLeft === 960) {

            currentDiv.style.display = "none";
            currentDiv = textDiv;
            textDiv.style.display = "block";

            let PrepTime = 90;
            let PrepTimer = setInterval(() => {
              if (PrepTime > 0) {
                let minutesPrepare = Math.floor(PrepTime / 60);
                let secondsPrepare = PrepTime % 60;
                document.getElementById("timerText").innerHTML = `–í—Ä–µ–º—è –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É: ${minutesPrepare}–º ${secondsPrepare}—Å`;
                PrepTime--;
              } else {
                clearInterval(PrepTimer);
                document.getElementById("timerText").innerHTML = "<b class='wrong-answer'>–£ –≤–∞—Å –µ—Å—Ç—å 1,5 –º–∏–Ω—É—Ç—ã, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å</b>";
              }
            }, milli);


        } else if (timeLeft === 780) {

            currentDiv.style.display = "none";
            currentDiv = adDiv;
            adDiv.style.display = "block";

            let PrepTime = 90;
            let PrepTimer = setInterval(() => {
              if (PrepTime > 0) {
                let minutesPrepare = Math.floor(PrepTime / 60);
                let secondsPrepare = PrepTime % 60;
                document.getElementById("timerAd").innerHTML = `–í—Ä–µ–º—è –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É: ${minutesPrepare}–º ${secondsPrepare}—Å`;
                PrepTime--;
              } else {
                clearInterval(PrepTimer);
                document.getElementById("timerAd").innerHTML = "<b class='wrong-answer'>–£ –≤–∞—Å –µ—Å—Ç—å 80 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å 4 –≤–æ–ø—Ä–æ—Å–∞</b>";
              }
            }, milli);


        } else if (timeLeft === 610) {

            currentDiv.style.display = "none";
            currentDiv = interviewDiv;
            interviewDiv.style.display = "block";
            document.getElementById("speaking-interview").play();

        } else if (timeLeft === 330) {

            currentDiv.style.display = "none";
            currentDiv = monologueDiv;
            monologueDiv.style.display = "block";

            let PrepTime = 150;
            let PrepTimer = setInterval(() => {
              if (PrepTime > 0) {
                let minutesPrepare = Math.floor(PrepTime / 60);
                let secondsPrepare = PrepTime % 60;
                document.getElementById("timerMonologue").innerHTML = `–í—Ä–µ–º—è –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É: ${minutesPrepare}–º ${secondsPrepare}—Å`;
                PrepTime--;
              } else {
                clearInterval(PrepTimer);
                document.getElementById("timerMonologue").innerHTML = "<b class='wrong-answer'>–£ –≤–∞—Å –µ—Å—Ç—å 3 –º–∏–Ω—É—Ç—ã, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å</b>";
              }
            }, milli);

        }
      }, milli);
    }

    startButton.addEventListener("click", startTimer);




  {% comment %} Audio {% endcomment %}
    var recordButton = document.getElementById("recordButton");
    var stopButton = document.getElementById("stopButton");
    var saveButton = document.getElementById("saveButton");

    var mediaRecorder;
    var chunks = [];


    recordButton.addEventListener("click", function() {
        // use the Web Audio API to start recording audio
        chunks = [];
        navigator.mediaDevices.getUserMedia({audio: true})
            .then(function(stream) {
                // create a new MediaRecorder object
                mediaRecorder = new MediaRecorder(stream);

                // enable the stop button
                stopButton.disabled = false;

                // start recording
                mediaRecorder.start();

                // when recording is complete, enable the save button
                mediaRecorder.addEventListener("dataavailable", function(event) {
                    chunks.push(event.data);
                });

                mediaRecorder.addEventListener("stop", function() {
                    var blob = new Blob(chunks, {type: 'audio/ogg; codecs=opus'});
                    var audioUrl = URL.createObjectURL(blob);

                    saveButton.disabled = false;

                    var source = document.getElementById("recordedAudioSource");
                    source.setAttribute("src", audioUrl);

                    var recordedAudio = document.getElementById("recordedAudio");
                    recordedAudio.load();

                    saveButton.addEventListener("click", function() {
                      window.onbeforeunload = null;
                      var formData = new FormData();
                      formData.append("audio", blob, 'recording.ogg');
                      var xhr = new XMLHttpRequest();
                      xhr.open("POST", "/speaking/" + saveButton.getAttribute("data-testname"));
                      xhr.onreadystatechange = function() {
                          if (xhr.readyState === 4 && xhr.status === 200) {
                            console.log(xhr.responseText);
                          }
                      };
                      xhr.send(formData);
                    });
                });
            });

        // disable the record button and enable the stop button
        recordButton.disabled = true;
    });

    stopButton.addEventListener("click", function() {
        // stop recording
        mediaRecorder.stop();

        // disable the stop button and enable the save button
        stopButton.disabled = true;
    });

  {% comment %} refresh / close prompt {% endcomment %}
    window.onbeforeunload = function() {
      return "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å / –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω!";
    };
</script>
{% endblock %}
